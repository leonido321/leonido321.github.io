{% extends 'gamification/base.html' %}
{% load math_filters %}  <!-- –î–û–ë–ê–í–õ–ï–ù–û: –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
{% block title %}–ú–æ–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}
{% block content %}
    <h2>‚≠ê –ú–æ–π –∫–∞–±–∏–Ω–µ—Ç</h2>
    <p><strong>–ò–º—è:</strong> {{ user.get_full_name|default:user.username }}</p>
    <p><strong>–ì—Ä—É–ø–ø–∞:</strong> 
        {% if profile.group %}
            {{ profile.group.name }}
        {% else %}
            –ù–µ —É–∫–∞–∑–∞–Ω–∞
        {% endif %}
    </p>
    <p><strong>–¢–µ–∫—É—â–∏–π —Å—á—ë—Ç:</strong> <span style="font-size: 1.5em;">{{ profile.stars }} ‚≠ê</span></p>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è -->
    {% if progress %}
    <div style="margin: 20px 0; padding: 15px; background: #e1bee7; border-radius: 8px;">
        <h3>üöÄ –í–∞—à —É—Ä–æ–≤–µ–Ω—å</h3>
        <p><strong>–¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å:</strong> 
            {% if progress.current_level %}
                {{ progress.current_level.name }}
            {% else %}
                –ù–æ–≤–∏—á–æ–∫
            {% endif %}
        </p>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä -->
        {% if next_level %}
        <div style="background: #ddd; height: 20px; border-radius: 10px; margin: 10px 0; overflow: hidden;">
            {% with progress_percent=progress.stars_earned|div:next_level.stars_required|mul:100 %}
            <div style="width: {{ progress_percent }}%; background: #6a1b9a; height: 100%; text-align: center; color: white; line-height: 20px; font-size: 0.8em;">
                {{ progress.stars_earned }} / {{ next_level.stars_required }} ‚≠ê
            </div>
            {% endwith %}
        </div>
        <p style="margin: 5px 0;"><strong>–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è:</strong> {{ next_level.name }} (–µ—â—ë {{ next_level.stars_required|add:progress.stars_earned|mul:"-1" }} ‚≠ê)</p>
        {% endif %}
    </div>
    {% endif %}

    <h3>üõí –ú–æ–∏ –ø–æ–∫—É–ø–∫–∏:</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
        {% for purchase in purchased_prizes %}
        <div class="card">
            <h4>{{ purchase.prize.name }}</h4>
            <p>{{ purchase.prize.description }}</p>
            <p><strong>–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏:</strong> {{ purchase.purchased_at|date:"d.m.Y H:i" }}</p>
        </div>
        {% empty %}
        <div class="card" style="text-align: center; padding: 20px;">
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–∑–æ–≤.</p>
            <img src="https://img.icons8.com/ios/100/000000/star--v1.png" alt="‚≠ê" style="width: 60px; opacity: 0.3;">
        </div>
        {% endfor %}
    </div>
{% endblock %}